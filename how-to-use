** Para usar o Arquivo de Configuração do Cloud init **

1 - Crie um arquivo de configuração no caminho /snip/snippets/ com o nome que preferir mas extensão .yml

    $ vim custom.yml

2 - Coloque o conteúdo do arquvio de configuraçã dentro.

exemplo: 

#cloud-config
hostname: teste
manage_etc_hosts: true
fqdn: teste
chpasswd:
  expire: False
user: manager
password: $5$mnijLZ8G$VEJPtAKycY8dnwZFbC3P4BjlV93E6x.Qrmts0Wg6k79
chpasswd:
  expire: False
users:
  - default
  - name: manager
    groups: sudo
    shell: /bin/bash
    ssh-authorized-keys:
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILILsFnLTU/u6PNNyZO/NGKjKcvTNLDGfKDXmMYQ29e+ manager@gunserver"
package_reboot_if_required: true
packages:
  - vim
  - git
  - qemu-guest-agent
  - apache2

runcmd:
  - systemctl start qemu-guest-agent
  - systemctl enable qemu-guest-agent
  - systemctl start apache2
  - systemctl enable apache2
  - echo "Bem-vindo, Mestre!" > /home/manager/boas-vindas.txt
  - apt purge -y cloud-init && rm -rf /etc/cloud /var/lib/cloud

3 - Faça o QM selecionar o arquivo de configuração novo para o template criado para o cloud-init rodar.

    $ qm set 9000 --cicustom "user=snip:snippets/custom.yml"

apos o set vai o ID do TEMPLATE
entre aspas é o caminho para o arquivo

4 - Agora clone o template para a criação da nova VM, e a inicie: no momento em que a VM é iniciada, o cloud init já começa a rodar o arquivo de configuração configurado. 



